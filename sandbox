#!/bin/sh
basename=buster
sandbox="$1"
arch=amd64
container="${basename}-${sandbox}-${arch}"

commandline="$*"

if  ! lxc-ls --running|grep $container; then
	echo 'Container not running, starting...'
	lxc-start -n $container -d
else
	lxc-attach --clear-env -n $container --clear-env -- killall $commandline
fi

echo "Using display $DISPLAY"
lxc-attach --clear-env -n $container -- sudo -u $USER -i\
	env DISPLAY=$DISPLAY $commandline
lxc-stop $container
